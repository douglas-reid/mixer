apiVersion: "config.istio.io/v1alpha2"
kind: census
metadata:
  name: handler
  namespace: istio-system
spec:
  handlerPort: 6677
  views:
  - name: "/global/request_count_view"
    displayName: "Global HTTP request count"
    count:
    cumulative:
    measure:
      name: "request_count_measure"
      displayName: "Request Count Measure"
      instanceName: "requestcount.metric.istio-system"
      unit: '"1"'
    tagNames:
    - "destination_service"
    - "destination_version"
    - "source_service"
    - "source_version"
  - name: "/global/request_duration_view"
    displayName: "Global HTTP request duration"
    distribution:
      bounds: [0, 1, 2, 3, 4, 5, 6, 8, 10, 13, 16, 20, 25, 30, 40, 50, 65, 80, 100, 130, 160, 200, 250, 300, 400, 500, 650, 800, 1000, 2000, 5000, 10000, 20000, 50000, 100000]
    cumulative:
    measure:
      name: "request_duration_measure"
      displayName: "Request Duration Measure"
      instanceName: "requestduration.metric.istio-system"
      unit: "ms"
    tagNames:
    - "destination_service"
    - "destination_version"
    - "source_service"
    - "source_version"
  - name: "/global/request_size_view"
    displayName: "Global HTTP request sizes"
    distribution:
      bounds: [0, 1024, 2048, 4096, 16384, 65536, 262144, 1048576, 4194304, 16777216, 67108864, 268435456, 1073741824, 4294967296]
    cumulative:
    measure:
      name: "request_size_measure"
      displayName: "Request Size Measure"
      instanceName: "requestsize.metric.istio-system"
      unit: "By"
    tagNames:
    - "destination_service"
    - "destination_version"
    - "source_service"
    - "source_version"
  - name: "/global/response_size_view"
    displayName: "Global HTTP response sizes"
    distribution:
      bounds: [0, 1024, 2048, 4096, 16384, 65536, 262144, 1048576, 4194304, 16777216, 67108864, 268435456, 1073741824, 4294967296]
    cumulative:
    measure:
      name: "response_size_measure"
      displayName: "Response Size Measure"
      instanceName: "responsesize.metric.istio-system"
      unit: "B"
    tagNames:
    - "destination_service"
    - "destination_version"
    - "source_service"
    - "source_version"
---
apiVersion: "config.istio.io/v1alpha2"
kind: rule
metadata:
  name: census
  namespace: istio-system
spec:
  actions:
  - handler: handler.census
    instances:
    - requestcount.metric
    - requestsize.metric
    - requestduration.metric
    - responsesize.metric